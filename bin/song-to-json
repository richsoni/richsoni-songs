#! /usr/bin/env node
var fs   = require('fs')
var path = require("path")

var fm         = require('front-matter')
var Remarkable = require('remarkable')

if(process.argv.length < 3){
  console.error('USAGE: front-matter {files}')
  process.exit(1)
}

md = new Remarkable({})

var json = process.argv
  .splice(2)
  .map(function(file){
    var data = fs.readFileSync(file, 'utf8')
    return [path.basename(file, '.md'), fm(data)]
  })
  .map(function(cons){
    var post      = cons[1]
    post.body = md.render(post.body)
    return [cons[0], post]
  })
  .reduce(function(memo, item){
    memo[item[0]] = item[1]
    return memo
  }, {})

console.log(JSON.stringify(json))
